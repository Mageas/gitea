* Gitea

* Nginx Setup
[[https://gitlab.com/Mageas/certginx][Certginx]] is used for simplicity.

Copy *nginx.conf* to *./nginx/conf.d/subdomain.domain.com.conf* in the [[https://gitlab.com/Mageas/certginx][Certginx]] directory.

Then follow the steps [[https://gitlab.com/Mageas/certginx][here]].

* Docker Setup
** Informations
| User   | Username |
|--------+----------|
| Host   | gitea    |
| Docker | git      |

** Key & Token
Generate new secrets/tokens.
#+BEGIN_SRC
sed -i -e 's/gitea_secret_key/'"$(docker run -it --rm gitea/gitea:1 gitea generate secret SECRET_KEY)"'/g' docker-compose.yml
sed -i -e 's/gitea_internal_token/'"$(docker run -it --rm gitea/gitea:1 gitea generate secret INTERNAL_TOKEN)"'/g' docker-compose.yml
#+END_SRC

** SSH Container Passthrough
Generate the SSH key pars.
#+BEGIN_SRC
sudo -u gitea ssh-keygen -t rsa -b 4096 -C "Gitea Host Key"
#+END_SRC

Configure the SSH folder.
#+BEGIN_SRC
sudo -u gitea cat /home/gitea/.ssh/id_rsa.pub | sudo -u gitea tee -a /home/gitea/.ssh/authorized_keys
sudo chmod 600 /home/gitea/.ssh/authorized_keys
#+END_SRC

Script for SSH passthrough
#+BEGIN_SRC
cat <<"EOF" | sudo tee /usr/local/bin/gitea
#!/bin/sh
ssh -p 2222 -o StrictHostKeyChecking=no git@127.0.0.1 "SSH_ORIGINAL_COMMAND=\"$SSH_ORIGINAL_COMMAND\" $0 $@"
EOF
sudo chmod +x /usr/local/bin/gitea
#+END_SRC
